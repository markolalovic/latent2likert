---
title: "Simulating Likert item responses in R"
author: "Marko Lalovic"
date: "Last Updated: `r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: false
vignette: >
  %\VignetteIndexEntry{Simulating Likert item responses in R}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "../man/figures/get_started/",
  dpi=250,
  fig.width=7,
  out.width = "98%")
```

This is a quick overview of the latent2likert package:

* [Generating random item responses](#generating-random-responses)

* [Correlations between latent variables](#adjusting-correlations)

* [Parameters of the latent distribution](#adjusting-parameters)

    - [Mean](#adjusting-the-mean)
    
    - [Standard deviation](#adjusting-sd)
    
    - [Skewness](#adjusting-skewness)
    
* [Estimation of latent parameters](#estimation-of-parameters)

* [Reconstruction of latent parameters](#resonstruction-of-parameters)


## Generating random item responses {#generating-random-responses}
First, load the package latent2likert, and set seed for reproducibility:
```{r}
# TODO: load the new package
# library(latent2likert) 
# set.seed(12345)
setwd("/Users/markolalovic/dev/latent2likert/")
source("./R/discretization.R")
source("./R/simulation.R")
source("./R/estimation.R")
source("./R/utilities.R")
```

To generate `size =10` responses with `n_levels = 5` response categories (on a 5-point Likert scale), use:
```{r}
rLikert(size = 10, n_levels = 5, n_items = 1)
```

To generate `size =100` responses to multiple Likert items on different scales (for example 4, 5 and 6), use:
```{r}
data <- rLikert(size = 100, n_levels = c(4, 5, 6), n_items = 3)
```

The result is an array of simulated responses, where columns represent responses to Likert items:
```{r}
head(data)
```

The corresponding bar plots are shown below:
```{r random_responses_barplots, fig.height=3, fig.width=10, fig.alt="Bar plots of simulated responses"}
par(mfrow=c(1, 3))
for(i in 1:3) {
  barplot(table(data[, i]))
  title(paste("Y", i, sep = ""))
}
```

## Correlations between latent variables {#adjusting-correlations}
To set a specific correlation between latent variables, such as 0.5, set `corr = 0.5`:
```{r}
data <- rLikert(size = 1000, n_levels = c(4, 5, 6), n_items = 3, corr = 0.5)
cor(data)
```

Alternatively, provide a correlation matrix. For instance, create a 3 by 3 correlation matrix:
```{r}
corr <- matrix(c(1.00, -0.63, -0.39, -0.63, 1.00, 0.41, -0.39, 0.41, 1.00), nrow=3)
corr
```

Then, use it to generate responses to Likert items with a latent correlation matrix R:
```{r}
data <- rLikert(size = 1000, n_levels = c(4, 5, 6), n_items = 3, corr = corr)
cor(data)
```

To use a random correlation matrix, set `R = "random"`:
```{r}
data <- rLikert(size = 1000, n_levels = c(4, 5, 6), n_items = 3, corr = "random")
cor(data)
```

## Parameters of the latent distribution {#adjusting-parameters}
By default, the function `rLikert` generates symmetrically distributed responses. To introduce asymmetry and alter the properties of hypothetical survey respondents, adjust the mean, standard deviation, and skewness `skew` of the latent distribution.

### Mean {#adjusting-the-mean}
To generate responses from latent distributions with different means, you can set the means using the `mu` parameter. For example, to set the means of latent distributions to -1, 0, and 1, execute:
```{r}
data <- rLikert(size = 1000, n_levels = 5, n_items = 3, mean =c(-1, 0, 1))
```

The generated responses and the corresponding densities of latent distributions are displayed below.
```{r adjusting_the_mean, fig.height=6, fig.width=10, fig.alt="Adjusting the mean"}
par(mfrow=c(2, 3))
for(i in 1:3) {
  barplot(table(data[, i]))
  title(paste("Y", i, sep = ""))
}
x <- seq(-5, 5, length = 1000)
y <- lapply(c(-1, 0, 1), function(mu) dnorm(x, mean = mu))
for(i in 1:3) {
  plot(x, y[[i]], type="l", lwd = 2, xlab = "", ylab = "")
  title(paste("X", i, sep = ""))
}
```

### Standard deviation {#adjusting-sd}
You can adjust the standard deviations of latent distributions using the `sd` parameter. For instance, specifying `sd = c(0.5, 1, 1.5)`:
```{r}
data <- rLikert(size =1000, n_levels = 5, n_items = 3, sd = c(0.5, 1, 1.5))
```

This generates the following responses with corresponding densities of latent distributions depicted below:
```{r adjusting_the_sd, fig.height=6, fig.width=10, fig.alt="Adjusting the standard deviation"}
par(mfrow=c(2, 3))
for(i in 1:3) {
  barplot(table(data[, i]))
  title(paste("Y", i, sep = ""))
}
y <- lapply(c(0.5, 1, 1.5), function(s) dnorm(x, sd = s))
for(i in 1:3) {
  plot(x, y[[i]], type="l", lwd = 2, xlab = "", ylab = "")
  title(paste("X", i, sep = ""))
}
```

### Skewness {#adjusting-skewness}
You can adjust the skewness of latent distributions using the `skew` parameter. For instance, specifying `skew = c(-0.5, 0, 0.5)` sets the skewness of latent distributions to -0.5, 0, and 0.5:
```{r}
data <- rLikert(size = 10^6, n_levels = 5, n_items = 3, skew = c(-0.5, 0, 0.5))
```

The resulting responses with corresponding densities of latent distributions are displayed below:
```{r adjusting_the_skewness, fig.height=6, fig.width=10, fig.alt="Adjusting the skewness"}
par(mfrow=c(2, 3))
for(i in 1:3) {
  barplot(table(data[, i]))
  title(paste("Y", i, sep = ""))
}
dp <- apply(cbind(rep(0, 3), rep(1, 3), c(-0.5, 0, 0.5)), 1, 
            function(x_row) { convert_params(as.vector(x_row)) })
x <- seq(-3, 3, length = 1000)
y <- lapply(1:3, function(i) { 
  density_sn(x, dp[["xi", i]], dp[["omega", i]], dp[["alpha", i]]) 
})
for(i in 1:3) {
  plot(x, y[[i]], type="l", lwd = 2, xlab = "", ylab = "")
  title(paste("X", i, sep = ""))
}
```

The `skew` parameter controls the skewness of the latent distribution. The value of `skew` is limited to slightly less than the interval (-1, 1):
$$
-0.95 \leq \text{skew} \leq 0.95
$$

A positive value makes the distribution right-skewed, while a negative value makes it left-skewed.

## Estimation of latent parameters {#estimation-of-parameters}
In order to replicate existing survey data, you can estimate the parameters of latent distributions using the function `estimate_parameters`.

As an illustration, let's generate 1000 responses with an underlying normal distribution having `mean =-0.5` and `sd = 0.5`, and assuming there are `n_levels = 5` response categories. Note that not all possible categories may have responses. In this example, `n`, `mu`, and `sd` are chosen such that no responses have a value of 5:
```{r}
set.seed(12345)
data <- rLikert(size = 1000, n_items = 1, mean = -0.5, sd = 0.5, n_levels = 5)
table(data)
```

In addition to the responses, the `estimate_parameters` function requires specifying the number of possible response categories `K` to return the estimates:
```{r}
estimate_parameters(data, n_levels = 5)
```

You can also provide responses to multiple items. For instance, if we generate responses to three items with different latent parameter values:
```{r estimation_of_parameters_for_multiple_items, fig.height=4, fig.width=10, fig.alt="Estimation of parameters for multiple items"}
data <- rLikert(size = 1000,
                n_items = 3,
                mean = c(1, 2, 3),
                sd = c(0.5, 1, 1.5),
                n_levels = c(5, 6, 7))
par(mfrow=c(1, 3))
for(i in 1:3) {
  barplot(table(data[, i]))
  title(paste("Y", i, sep = ""))
}
```
